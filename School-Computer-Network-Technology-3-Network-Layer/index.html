
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>计算机网络原理 • （三）网络层 - PhoenixNest&#39;s Blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate"/>
    
        <meta name="keywords" content="PhoenixNest,PhoenixNest&#39;s Blog,">
    
    
        <meta name="description" content="PhoenixNest&#39;s Blog • 用实力让情怀落地,引言
本篇是对计算机网络原理一文中的网络层的详细介绍。所用教学平台：Cisco Networking Academy


网络层（第3层）
网络层即 OSI 第 3 层，提供能够让终端设备跨整个网络,">
    
    
        <meta name="author" content="PhoenixNest">
    
    
        <link rel="alternative" href="atom.xml" title="PhoenixNest&#39;s Blog" type="application/atom+xml">
    
    
        <link rel="icon" href="/img/favicon.png">
    
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.7.2/animate.min.css">

    
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/codemirror.min.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/theme/dracula.css">

    
<link rel="stylesheet" href="/css/obsidian.css">

    
<link rel="stylesheet" href="/css/ball-atom.min.css">

    
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="loading">
<div class="loader">
    <div class="la-ball-atom la-2x">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
</div>
<span id="config-title" style="display:none">PhoenixNest&#39;s Blog</span>
<div id="loader"></div>
<div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/favicon.png" alt="" data-url="https://phoenixnest.github.io">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">计算机网络原理 • （三）网络层</h3>
        <div class="social">
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
                animation-delay: 600ms;
                animation-duration: 1.2s;
                background-image:
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/cisco.jpg) ">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                    <a href="/categories/计算机网络"><b>「
                        </b>计算机网络<b> 」</b></a>
                
                一月 11, 2021
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/School-Computer-Network-Technology-3-Network-Layer/" title="计算机网络原理 • （三）网络层" class="">计算机网络原理 • （三）网络层</a>
            </h3>
            
                <p class="post-count animated fadeInDown">
                    
                        <span>
                    <b class="iconfont icon-text2"></b> <i>文章字数</i>
                    11k
                </span>
                    
                    
                        <span>
                    <b class="iconfont icon-timer__s"></b> <i>阅读约需</i>
                    19 mins.
                </span>
                    
                    
                        <span id="/School-Computer-Network-Technology-3-Network-Layer/" class="leancloud_visitors"
                              data-flag-title="计算机网络原理 • （三）网络层">
                    <b class="iconfont icon-read"></b> <i>阅读次数</i>
                    <span class="leancloud-visitors-count">0</span>
                </span>
                    
                    
                </p>
            
            
                <ul class="animated fadeInDown post-tags-list" itemprop="keywords"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/%E5%A4%A7%E5%AD%A6/" rel="tag">大学</a></li><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" rel="tag">计算机基础</a></li><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86/" rel="tag">计算机网络原理</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><blockquote>
<p>本篇是对<a href="https://phoenixnest.github.io/Notes-Computer-Network-Technology/">计算机网络原理</a>一文中的<a href="https://phoenixnest.github.io/School-Computer-Network-Technology/#%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%88%E7%AC%AC-3-%E5%B1%82%EF%BC%89">网络层</a>的详细介绍。<br>所用教学平台：<a href="%22https://cn.netacad.com/%22">Cisco Networking Academy</a></p>
</blockquote>
<hr>
<h2 id="网络层（第3层）"><a href="#网络层（第3层）" class="headerlink" title="网络层（第3层）"></a>网络层（第3层）</h2><blockquote>
<p>网络层即 OSI 第 3 层，提供能够让终端设备跨整个网络交换数据的服务。如图所示，IP 版本 4 (IPv4) 和 IP 版本 6 (IPv6) 是主要的网络层通信协议。其他网络层协议包括<strong>路由协议</strong>，如开放式最短路径优先协议(OSPF)，和<strong>消息传递协议</strong>，如<strong>Internet控制消息协议</strong>(ICMP)。</p>
</blockquote>
<h3 id="网络层协议"><a href="#网络层协议" class="headerlink" title="网络层协议"></a>网络层协议</h3><p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_1.png" alt="网络层"></p>
<p>为了实现跨网络边界的端到端通信，<code>网络层协议执行四个基本操作</code>:</p>
<ul>
<li><p><strong>终端设备编址</strong> - 必须为终端设备配置唯一的 IP 地址，以便在网络上进行识别。</p>
</li>
<li><p><strong>封装</strong> - 网络层将来自传输层的<strong>协议数据单元 (PDU)</strong> 封装到数据包中。封装过程中会添加 IP 报头信息，例如来源（发送）和目的（接收）主机的 IP 地址。封装过程由 IP 数据包的源主机执行。</p>
</li>
<li><p><strong>路由</strong> - 网络层提供服务，将数据包转发至另一网络上的目的主机。要传送到其他网络，数据包必须经过路由器的处理。路由器的作用是为数据包选择最佳路径，并将其转发至目的主机，该过程称为路由。数据包可能需要经过很多路由器才能到达目的主机。数据包在到达目的主机的过程中经过的每个路由器均称作一跳。</p>
</li>
<li><p><strong>解封</strong> - 当数据包到达目的主机的网络层时，主机会检查数据包的 IP 报头。如果在报头中的目的 IP 地址与其自身的 IP 地址匹配，IP 报头将被会从数据包中删除。网络层解封数据包后，后继的第 4 层 PDU 会向上传递到传输层的相应服务。解封过程由 IP 数据包的目的主机执行。</p>
</li>
</ul>
<blockquote>
<p>传输层（OSI 第 4 层）负责管理每台主机上的运行进程之间的数据传输，而网络层通信协议（即，IPv4和IPv6）则指定从一台主机向另一台主机传送数据时使用的数据包结构和处理过程。网络层工作时无需考虑每个数据包中所携带的数据，这使其能够为多台主机之间的多种类型的通信传送数据包。</p>
</blockquote>
<hr>
<h3 id="IP-封装"><a href="#IP-封装" class="headerlink" title="IP 封装"></a>IP 封装</h3><blockquote>
<p>IP 通过添加 IP 报头将传输层（网络层之上的层）数据段或其他数据进行封装。IP报头用于将数据包传送到目的主机。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_2.png" alt="网络层 PDU 如何封装传输层 PDU 来创建 IP 数据包"></p>
<p>逐层封装数据的流程使我们可以开发和扩展位于不同层的服务而不影响其他层。<strong>这意味着传输层数据段可以随时通过 IPv4 或 IPv6 进行封装，或使用未来可能开发出的任何新协议进行封装</strong>。</p>
<p><code>IP数据包在通过网络传输到其目的地时，会被第3层设备（即路由器和第3层交换机）检查IP报头</code>。需要注意的是，<code>从数据包离开源主机到达目的主机之前，IP编址信息保持不变，除非是由为IPv4执行网络地址转换(NAT)的设备进行转换</code>。</p>
<blockquote>
<p>路由器实施路由协议以在网络之间路由数据包。这些中间设备所执行的路由进程会检查数据包报头中的网络层地址。在任何情况下，数据包的数据部分，即封装的传输层 PDU或其他数据，在网络层的各个过程中都保持不变。</p>
</blockquote>
<hr>
<h3 id="IP-特征"><a href="#IP-特征" class="headerlink" title="IP 特征"></a>IP 特征</h3><blockquote>
<p>IP 被设计为一种低开销协议。它只提供通过互连的网络系统从源主机向目的主机传送数据包所必需的功能。<strong>该协议并不负责跟踪和管理数据包的流动</strong>。<code>这些功能（如果需要）将由其他层的其他协议（主要是第 4 层的 TCP）执行</code>。</p>
</blockquote>
<p>这些是IP的基本特征：</p>
<ul>
<li><p><strong>无连接</strong> - 发送数据包前不与目的地建立连接。</p>
</li>
<li><p><strong>尽力而为</strong> - IP本质上是不可靠的，因为不保证数据包交付。</p>
</li>
<li><p><strong>介质无关性</strong> - 其工作与传输数据的介质（即铜缆、光纤或无线）无关。</p>
</li>
</ul>
<hr>
<h3 id="无连接"><a href="#无连接" class="headerlink" title="无连接"></a>无连接</h3><blockquote>
<p>IP 是无连接协议，这意味着发送数据前IP不会创建专用的端到端连接。<code>无连接通信的概念类似于不事先通知收件人就邮寄信件</code>。图中总结了这些要点。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_3_1.png" alt="无连接 - 类比"></p>
<blockquote>
<p>无连接数据通信按照同样的原理工作。如图所示，IP 在转发数据包前，并<code>不需要初步交换控制信息来创建端到端连接</code>。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_3_2.png" alt="无连接 - 网络"></p>
<hr>
<h3 id="“尽力而为”-Best-Effort"><a href="#“尽力而为”-Best-Effort" class="headerlink" title="“尽力而为”(Best Effort)"></a>“尽力而为”(Best Effort)</h3><blockquote>
<p><code>IP 也不需要报头中包含其他字段来维持建立的连接</code>。此过程<strong>显著降低了 IP 的开销</strong>。但是，<strong>由于没有预先建立端到端连接，发送数据包时，发送方不知道目的地是否存在和正常运行，同时发送数据包时，也不会知道目的地是否接收数据包，或者，目的设备是否可以访问并读取数据包</strong>。</p>
</blockquote>
<p>IP 协议不保证交付的所有数据包都能被收到。图中显示了 IP 协议不可靠或尽力交付的特征。</p>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_4.png" alt="IP 协议不可靠或尽力交付的特征"></p>
<hr>
<h3 id="介质无关性"><a href="#介质无关性" class="headerlink" title="介质无关性"></a>介质无关性</h3><blockquote>
<p><strong>不可靠</strong><code>表示 IP 不具备管理和恢复未送达数据包或已损坏数据包的能力</code>。</p>
<blockquote>
<p>这是因为，在根据传输位置信息传输 IP 数据包时，数据包不包含可以经过处理以通知发送方信息交付是否成功的消息。传送到时，数据包可能已经损坏或顺序错乱，或者根本就没有传送成功。<code>如果出错，IP 无法重新传输数据包</code>。</p>
</blockquote>
</blockquote>
<blockquote>
<p>如果数据包顺序错乱或丢失，则使用数据或上层服务的应用程序必须解决这些问题。这让 IP 可以非常有效地发挥作用。<code>在 TCP/IP 协议簇中，可靠性是TCP协议在传输层的功能</code>。</p>
</blockquote>
<p><code>IP 的工作与在协议栈低层传送数据的介质无关</code>。如图所示，IP 数据包既可以作为电信号通过铜缆传送，也可以作为光信号通过光纤传送或作为无线电信号无线传送。</p>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_5.png" alt="可以通过不同介质传送 IP 数据包"></p>
<p><strong>OSI 数据链路层</strong>负责接收数据包并准备数据包以在通信介质上传输。<code>这就意味着 IP 数据包的交付不限于任何特定的介质</code>。</p>
<p>但是，网络层会考虑介质的一个重要特征：每种介质可以传输的最大 PDU 大小。此特征称为最大传输单位 (MTU)。数据链路层和网络层之间的部分控制通信就是确定数据包的最大尺寸。数据链路层将 MTU 值向上传送到网络层。网络层会由此确定可以传送的数据包的大小。</p>
<p>有时，中间设备（通常是路由器），在将<code>IPv4数据包</code>从一个介质转发到具有更小 MTU 的介质时，<code>必须分割数据包</code>。此过程称为数据包分片或分片。<code>分片会导致延迟</code>。<code>IPv6 数据包不能被路由器分片</code>。</p>
<hr>
<h2 id="IPv4-数据包"><a href="#IPv4-数据包" class="headerlink" title="IPv4 数据包"></a>IPv4 数据包</h2><h3 id="IPv4-数据包报头"><a href="#IPv4-数据包报头" class="headerlink" title="IPv4 数据包报头"></a>IPv4 数据包报头</h3><blockquote>
<p>IPv4 是主要网络层通信协议之一。IPv4 数据包报头用于确保此数据包在到达目的地终端设备的路上被传递到其下一站。</p>
</blockquote>
<blockquote>
<p>IPv4 数据包报头是由包含重要数据包信息的字段组成。这些字段中包含的二进制数字由第 3 层进程进行检查。</p>
</blockquote>
<hr>
<h3 id="IPv4-数据包报头字段"><a href="#IPv4-数据包报头字段" class="headerlink" title="IPv4 数据包报头字段"></a>IPv4 数据包报头字段</h3><blockquote>
<p>每个字段的二进制值均用于确定 IP 数据包的各种设置。协议报头图（从左到右、从上到下阅读）可提供在讨论协议字段时参考的直观图。图中所示的 IP 协议报头图标识了 IPv4 数据包中的字段。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_7.png" alt="IPv4数据包报头中的字段"></p>
<p><code>两种最常参考的字段是源和目的 IP 地址</code>。<strong>这些字段用于确定数据包的源位置和目的位置</strong>。通常，在从源传输到目的地期间，这些地址不会改变。</p>
<p><strong>互联网报头长度（IHL）</strong>、<strong>总长度</strong>和<strong>报头校验</strong>和<strong>字段</strong><code>用于识别和验证数据包</code>。</p>
<blockquote>
<p><code>其他字段用于重新排列分段的数据包</code>。具体而言，<strong>IPv4 数据包使用标识符、标志和片偏移量字段跟踪分段</strong>。<strong>路由器从一种介质向具有较小 MTU 的另一种介质转发IPv4数据包时必须将它分片</strong>。</p>
</blockquote>
<hr>
<h2 id="IPv6-数据包"><a href="#IPv6-数据包" class="headerlink" title="IPv6 数据包"></a>IPv6 数据包</h2><h3 id="IPv4-的局限性"><a href="#IPv4-的局限性" class="headerlink" title="IPv4 的局限性"></a>IPv4 的局限性</h3><blockquote>
<p>多年来，为应对新的挑战，已经制定了附加议定书和规程。但是，尽管经历了多次变更，IPv4 仍然有三个重要问题：</p>
</blockquote>
<ul>
<li><strong>IPv4地址耗尽</strong> -  IPv4 的<code>可用唯一公有地址数量有限</code>。尽管<code>有大约 40 亿的 IPv4 地址</code>，但是支持 IP 的新设备数量的不断增加，以及始终在线的连接的增加，和欠发达地区的潜在连接的增加，不断催生更多的地址需求。</li>
<li><strong>缺乏端到端连接</strong> -  <strong>网络地址转换（NAT）</strong>是 IPv4 网络中经常实施的一项技术。NAT 为多种设备共享单一的公有 IPv4 地址提供方法。但是，因<code>为共享了公有 IPv4 地址，内部网络主机的 IPv4 地址会隐藏起来。这会给需要端到端连接的技术造成难题</code>。</li>
<li><strong>增加的网络复杂性</strong> - 虽然 NAT 延长了 IPv4 的寿命，但它只是作为一种过渡到 IPv6 的机制。NAT 在其各种实施中增加了网络的复杂性，从而造成延迟并使故障排除更加困难。</li>
</ul>
<hr>
<h3 id="IPv6-概述"><a href="#IPv6-概述" class="headerlink" title="IPv6 概述"></a>IPv6 概述</h3><p>早在 20 世纪 90 年代早期，互联网工程任务组 (IETF) 就增加了对 IPv4 相关问题的关注并开始寻找替代方案。这促使了 IP 版本 6 (IPv6) 的开发。IPv6 解决了 IPv4 的限制并有着显著的功能提升，它能更好地适应当前和可预见的网络需求。</p>
<blockquote>
<p>IPv6 的功能提升包括以下：</p>
</blockquote>
<ul>
<li><p><strong>更大的地址空间</strong> - IPv6 地址基于 128 位分层编址，而 IPv4 采用的是 32 位。</p>
</li>
<li><p><strong>改进数据包处理过程</strong> - IPv6 报头简化为更少的字段。</p>
</li>
<li><p><strong>消除了对 NAT 的需求</strong> - 有了数额如此巨大的公有 IPv6 地址，私有 IPv4 地址和公有 IPv4 地址之间不再需要 NAT。这可避免需要端到端连接的应用程序遇到某些由 NAT 引起的故障。</p>
</li>
</ul>
<p>32 位的 IPv4 地址空间提供大约 4,294,967,296 个地址。IPv6 地址空间提供 340,282,366,920,938,463,463,374,607,431,768,211,456 个或 340 涧（10 的 36 次方）个地址。这大致相当于地球上的每一粒沙子。</p>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_9.png" alt="IPv4 和 IPv6 地址空间的可视比较"></p>
<hr>
<h3 id="IPv6数据包报头中的IPv4数据包报头字段"><a href="#IPv6数据包报头中的IPv4数据包报头字段" class="headerlink" title="IPv6数据包报头中的IPv4数据包报头字段"></a>IPv6数据包报头中的IPv4数据包报头字段</h3><blockquote>
<p>IPv6 较 IPv4 的一个重大改进是简化的 IPv6 报头。</p>
</blockquote>
<p>例如，IPv4 报头包含 20 个二进制八位组的可变长度报头（如果使用“选项”字段，则高达 60 字节）和 12 个基本报头字段（不包括“选项”字段和“填充”字段）。</p>
<blockquote>
<p>对于 IPv6，某些字段保持不变，某些字段的名称和位置发生了变化，而某些 IPv4 字段不再需要，正如图中突出显示。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_10_1.png" alt="IPv4 数据包报头"></p>
<blockquote>
<p>相比而言，下图显示的简化 IPv6 报头包含 40 个二进制八位数的固定长度报头（主要为源和目的 IPv6 地址的长度）。</p>
</blockquote>
<p><code>IPv6 简化报头允许更高效地处理 IPv6 报头</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_10_2.png" alt="IPv6 数据包报头"></p>
<hr>
<h3 id="IPv6-数据包报头"><a href="#IPv6-数据包报头" class="headerlink" title="IPv6 数据包报头"></a>IPv6 数据包报头</h3><p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_11.png" alt="IPv6 数据包报头"></p>
<blockquote>
<p>IPv6 数据包还可能包含扩展报头（EH），以便提供可选的网络层信息。扩展报头为可选项，位于 IPv6 报头及负载之间。EH 用于分段、安全性、移动性支持等。</p>
</blockquote>
<p><code>与 IPv4 不同，路由器不会对路由的 IPv6 数据包进行分段</code>。</p>
<hr>
<h2 id="主机路由方式"><a href="#主机路由方式" class="headerlink" title="主机路由方式"></a>主机路由方式</h2><h3 id="主机转发决策"><a href="#主机转发决策" class="headerlink" title="主机转发决策"></a>主机转发决策</h3><blockquote>
<p>对于IPv4和IPv6，数据包总是在源主机上创建。源主机必须能够将数据包定向到目的主机。为此，主机终端设备将创建自己的路由表。本主题讨论终端设备如何使用路由表。</p>
</blockquote>
<p><strong>网络层的另一个作用是在主机之间转发数据包</strong>。主机可以将数据包发送至如下：</p>
<ul>
<li><p><strong>主机自己</strong> - 主机可以通过向特定的地址发送数据包来向自己发起ping测试，这个特定的地址是：IPv4地址127.0.0.1，或者IPv6地址 ::1，它被称为环回接口。对环回接口执行 ping 操作可以测试主机上的 TCP/IP 协议堆栈。</p>
</li>
<li><p><strong>本地主机</strong> - 目的主机与发送主机位于同一本地网络。源和目的主机共享同一个网络地址。</p>
</li>
<li><p><strong>远程主机</strong> - 这是位于远程网络上的目的主机。源和目的主机不共享同一个网络地址。</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_12.png" alt=" PC1 连接到同一网络上的本地主机和位于另一网络上的远程主机"></p>
<blockquote>
<p><code>数据包是要发送到本地主机还是远程主机是由源端设备决定的</code>。<strong>源端设备确定目的 IP 地址是否与源设备本身所在的网络相同。确定方法因 IP 版本不同而异</strong>：</p>
</blockquote>
<ul>
<li><p><strong>在 IPv4 中</strong> -源设备使用自己的子网掩码以及自己的 IPv4 地址和目的 IPv4 地址来进行此判断。</p>
</li>
<li><p><strong>在 IPv6 中</strong> -本地路由器将本地网络地址（前缀）通告给网络上的所有设备。</p>
</li>
</ul>
<p>在家庭或企业网络中，您可能有若干通过中间设备（<strong>LAN 交换机</strong>和/或<strong>无线接入点（WAP）</strong>等）互联的有线和无线设备。这种中间设备在本地网络上的本地主机之间提供互联服务。本地主机可以互相访问和共享信息，无需任何附加设备。如果主机要将数据包发送到与本主机在同一 IP 网络中的设备，则数据包仅是被转发出主机接口，然后经过中间设备即可直接到达目的设备。</p>
<p>当然，在大多数情况下我们希望我们的设备不仅仅能够连接本地网段，还能连接其他家庭、企业和互联网。位于本地网段外的设备称为远程主机。<code>如果源设备发送数据包到远程目的设备，则需要借助路由器和路由。路由是确定到达目的地之最佳路径的过程。连接到本地网段的路由器称为默认网关</code>。</p>
<hr>
<h3 id="默认网关"><a href="#默认网关" class="headerlink" title="默认网关"></a>默认网关</h3><blockquote>
<p>默认网关是可以将流量路由到其他网络的网络设备（即，路由器或第3层交换机）。如果把一个网络比作一个房间，那么默认网关就好比是门口。如果要去另一个房间或网络，您就需要找到门口。</p>
</blockquote>
<p>在网络上，<code>默认网关通常是</code>具有以下功能的<code>路由器</code>：</p>
<ul>
<li><p>它拥有与本地网络其他主机位于相同地址范围的本地 IP 地址。</p>
</li>
<li><p>它可以接受数据到本地网络，并将数据转发出本地网络。</p>
</li>
<li><p>它向其他网络路由流量。</p>
</li>
</ul>
<blockquote>
<p>需要使用默认网关来发送本地网络之外的流量。如果没有默认网关、未配置默认网关地址或默认网关关闭，则无法将流量转发到本地网络之外。</p>
</blockquote>
<hr>
<h3 id="主机路由到默认网关"><a href="#主机路由到默认网关" class="headerlink" title="主机路由到默认网关"></a>主机路由到默认网关</h3><p>主机的路由表通常包括默认网关。在IPv4中，主机通过动态主机配置协议 (DHCP) 动态接收默认网关 IPv4 地址，或者通过手动配置。在 IPv6 中，路由器通告默认网关地址，或者可以在主机上手动配置。</p>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_13.png" alt="PC1 和 PC2 均配置了 IPv4 地址 192.168.10.1作为默认网关"></p>
<p>配置默认网关会在 PC 的路由表中创建一个默认路由。默认路由是计算机尝试联系远程网络时所用的路由或路径。</p>
<p>PC1 和 PC2 都会使用默认路由将去往远程网络的所有流量发送到 R1。</p>
<hr>
<h3 id="主机路由表"><a href="#主机路由表" class="headerlink" title="主机路由表"></a>主机路由表</h3><p>在 Windows 主机上，使用route print或命netstat -r令可以显示主机路由表。这两个命令生成相同的输出。输出可能乍一看很晦涩，但是实际上相当容易理解。</p>
<p><img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_14.png" alt="PC1 和 PC2 均配置了 IPv4 地址 192.168.10.1作为默认网关"></p>
<pre><code class="bash"># PC1 的 IPv4 路由表
C:\Users\PC1&gt; netstat -r 
IPv4 Route Table
===========================================================================
Active Routes:
Network Destination Netmask Gateway Interface Metric
0.0.0.0 0.0.0.0 192.168.10.1 192.168.10.10 25
127.0.0.0 255.0.0.0 On-link 127.0.0.1 306
127.0.0.1 255.255.255.255 On-link 127.0.0.1 306
127.255.255.255 255.255.255.255 On-link 127.0.0.1 306
192.168.10.0 255.255.255.0 On-link 192.168.10.10 281
192.168.10.10 255.255.255.255 On-link 192.168.10.10 281
192.168.10.255 255.255.255.255 On-link 192.168.10.10 281
224.0.0.0 240.0.0.0 On-link 127.0.0.1 306
224.0.0.0 240.0.0.0 On-link 192.168.10.10 281
255.255.255.255 255.255.255.255 On-link 127.0.0.1 306
255.255.255.255 255.255.255.255 On-link 192.168.10.10 281
</code></pre>
<p>输入<strong>netstat -r</strong>命令或等效的<strong>route print</strong>命令，显示有关当前 TCP/IP 网络连接的三个部分：</p>
<ul>
<li><p><strong>接口列表</strong> - 列出主机上的介质访问控制（MAC）地址和每个网络接口的已分配接口编号，包括以太网、Wi-Fi 和蓝牙适配器。</p>
</li>
<li><p><strong>IPv4 路由表</strong> - 列出所有已知的 IPv4 路由，包括直接连接、本地网络和本地默认路由。</p>
</li>
<li><p><strong>IPv6 路由表</strong> - 列出所有已知的 IPv6 路由，包括直接连接、本地网络和本地默认路由。</p>
</li>
</ul>
<hr>
<h2 id="路由简介"><a href="#路由简介" class="headerlink" title="路由简介"></a>路由简介</h2><h3 id="路由器数据包转发决策"><a href="#路由器数据包转发决策" class="headerlink" title="路由器数据包转发决策"></a>路由器数据包转发决策</h3><blockquote>
<p>大多数网络还包含作为中间设备的路由器。路由器中也包含路由表。本主题涵盖网络层上路由器的运行。当一台主机发送数据包到另一台主机时，它将查询路由表来确定将数据包发送到哪里。如果目的主机位于远程网络，则数据包会被转发到默认网关，通常是本地路由器。</p>
</blockquote>
<blockquote>
<p>数据包到达路由器接口时，路由器会检查数据包的目的 IP 地址并搜索其路由表以确定将数据包转发到何处。<code>路由表包含所有已知网络地址（前缀）以及数据包转发位置的列表。这些条目称为路由条目或路由</code>。<strong>路由器将使用最佳（最长）匹配的路由条目转发数据包</strong>。</p>
</blockquote>
<img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_15.png">

<p>下表显示了来自<code>R1路由表</code>的相关信息。</p>
<table>
<thead>
<tr>
<th align="center">路由</th>
<th align="center">下一跳或出口接口</th>
</tr>
</thead>
<tbody><tr>
<td align="center">192.168.10.0 /24</td>
<td align="center">G0/0/0</td>
</tr>
<tr>
<td align="center">209.165.200.224/30</td>
<td align="center">G0/0/1</td>
</tr>
<tr>
<td align="center">10.1.1.0/24</td>
<td align="center">通过 R2</td>
</tr>
<tr>
<td align="center">默认路由 0.0.0.0/0</td>
<td align="center">通过 R2</td>
</tr>
</tbody></table>
<hr>
<h3 id="IP-路由器路由表"><a href="#IP-路由器路由表" class="headerlink" title="IP 路由器路由表"></a>IP 路由器路由表</h3><p><code>路由器的路由表包含所有可能的已知目的地网络的路由条目列表。</code></p>
<p>路由表存储三种类型的路由条目：</p>
<ul>
<li><p><strong>直连网络</strong> - 这些网络路由条目是活动的路由器接口。当接口配置了 IP 地址并激活时，路由器会添加直连路由。每个路由器接口均连接到一个不同的网段。在图中，R1 IPv4路由表中的直连网络为192.168.10.0/24和209.165.200.224/30。</p>
</li>
<li><p><strong>远程网络</strong> - 这些网络路由条目连接到其他路由器。路由器通过由管理员明确配置或使用动态路由协议交换路由信息来学习远程网络。在图中，R1 IPv4路由表中的远程网络为10.1.1 /24。</p>
</li>
<li><p><strong>默认路由</strong> - 像主机一样，大多数路由器还包含默认路由条目，即默认网关。当IP路由表中没有更好(更长)的匹配时，将使用默认路由。在图中，R1 IPv4路由表很可能包含一个将所有数据包转发到路由器R2的默认路由。</p>
</li>
</ul>
<p>该图用于确定路由器 R1 的直连和远程网络。</p>
<img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_16.png">

<p>路由器可通过两种方式获知远程网络：</p>
<ul>
<li><p><strong>手动</strong> - 使用静态路由将远程网络手动输入到路由表中。</p>
</li>
<li><p><strong>动态</strong> - 使用动态路由协议自动学习远程路由。</p>
</li>
</ul>
<hr>
<h3 id="静态路由"><a href="#静态路由" class="headerlink" title="静态路由"></a>静态路由</h3><blockquote>
<p><strong>静态路由是手动配置的路由条目</strong>。下图显示了在路由器 R1 上手动配置的静态路由的示例。<strong>静态路由包括远程网络地址和下一跳路由器的IP地址</strong>。</p>
</blockquote>
<img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_17_1.png">

<blockquote>
<p>如果网络拓扑改变，静态路由不会自动更新，必须手动重新配置静态路由。例如，在图中，R1有一条通过R2到达10.1.1.0/24网络的静态路由。如果该路径不再可用，R1将需要重新配置一个新的静态路由，通过R3到达10.1.1.0/24网络。因此，路由器R3需要在其路由表中有一个路由条目，以便将目的地为10.1.1.0/24的数据包发送到R2。</p>
</blockquote>
<img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_17_2.png">

<p>静态路由具有以下特征：</p>
<ul>
<li><p><code>必须手动配置静态路由</code>。</p>
</li>
<li><p>如果拓扑发生变化，且静态路由不再可用，则管理员需要重新配置静态路由。</p>
</li>
<li><p>静态路由适用于小型网络且当冗余链路很少或没有冗余链路的情况。</p>
</li>
<li><p>静态路由通常与动态路由协议一起用于配置默认路由。</p>
</li>
</ul>
<hr>
<h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><blockquote>
<p><code>动态路由协议可让路由器从其他路由器那里自动学习远程网络，包括默认路由</code>。如果使用动态路由协议，则路由器无需网络管理员的参与，即可自动与其它路由器共享路由信息并对拓扑结构的变化作出反应。如果网络拓扑发生变化，路由器将使用动态路由协议共享此信息，并自动更新路由表。</p>
</blockquote>
<p><code>动态路由协议</code>包括<strong>开放式最短路径优先路由协议（OSPF）</strong>和<strong>增强型内部网关路由协议（EIGRP）</strong>。该图显示了路由器 R1 和 R2 使用路由协议 OSPF 自动共享网络信息的示例。</p>
<img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_18_1.png">

<p><code>基本配置只需要网络管理员在动态路由协议中启用直连网络</code>。动态路由协议将自动执行如下操作：</p>
<ul>
<li><p>发现远程网络。</p>
</li>
<li><p>维护最新路由信息。</p>
</li>
<li><p>选择通往目的网络的最佳路径。</p>
</li>
<li><p>当前路径无法再使用时尝试找出新的最佳路径。</p>
</li>
</ul>
<p><strong>当使用静态路由手动配置路由器或使用动态路由协议动态学习远程网络时，远程网络地址和下一跳地址将被输入到IP路由表中</strong>。如图所示，如果网络拓扑发生变化，路由器将自动调整并尝试找到新的最佳路径。</p>
<img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_18_2.png">

<p>注意: <strong>通常一些路由器会同时使用静态路由和动态路由协议</strong>。</p>
<hr>
<h3 id="IPv4-路由表简介"><a href="#IPv4-路由表简介" class="headerlink" title="IPv4 路由表简介"></a>IPv4 路由表简介</h3><blockquote>
<p>请注意，在图中 R2 连接到了互联网。因此，当路由表中没有与目的IP 地址匹配的特定条目时，管理员将为 R1 配置默认静态路由，将数据包发送到 R2。R1和R2还使用OSPF路由来通告直连的网络。</p>
</blockquote>
<img src="https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Notes/Computer%20Network%20Technology/6_19.png">

<pre><code class="CISCO">R1# show ip route
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area 
       N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
       E1 - OSPF external type 1, E2 - OSPF external type 2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, * - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       a - application route
       + - replicated route, % - next hop override, p - overrides from PfR
Gateway of last resort is 209.165.200.226 to network 0.0.0.0
S*    0.0.0.0/0 [1/0] via 209.165.200.226, GigabitEthernet0/0/1
      10.0.0.0/24 is subnetted, 1 subnets
O        10.1.1.0 [110/2] via 209.165.200.226, 00:02:45, GigabitEthernet0/0/1
      192.168.10.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.10.0/24 is directly connected, GigabitEthernet0/0/0
L        192.168.10.1/32 is directly connected, GigabitEthernet0/0/0
      209.165.200.0/24 is variably subnetted, 2 subnets, 2 masks
C        209.165.200.224/30 is directly connected, GigabitEthernet0/0/1
L        209.165.200.225/32 is directly connected, GigabitEthernet0/0/1
R1#
</code></pre>
<p>特权 <strong>EXEC</strong> 模式命令 <strong>show ip route</strong> 用于查看<code>思科 IOS 路由器</code>上的 IPv4 路由表。该示例显示了路由器 R1 的 IPv4 路由表。每个路由表条目的开头都有一个代码，用于标识路由的类型或路由的学习方式。常见路由源（代码）包括以下内容：</p>
<ul>
<li><p><strong>L</strong> - 直连的本地接口 IP 地址</p>
</li>
<li><p><strong>C</strong> - 直连网络</p>
</li>
<li><p><strong>S</strong> - 静态路由由管理员手动配置</p>
</li>
<li><p><strong>O</strong> - OSPF</p>
</li>
<li><p><strong>D</strong> - EIGRP</p>
</li>
</ul>
<p>路由表显示 R1 的所有已知 IPv4 目的地路由。</p>
<blockquote>
<p>当路由器接口配置了IP地址信息并激活时，将自动创建直连路由。该路由器添加了两个带有代码C(即所连接的网络)，和L(即连接网络的本地接口IP地址)的路由条目。路由条目还标识用于到达网络的出口接口。</p>
</blockquote>
<p>本示例中的两个直连网络分别为192.168.10.0/24 和 209.165.200.224/30。</p>
<p>路由器 R1 和 R2 还使用 OSPF 动态路由协议交换路由器信息。在示例路由表中，R1 具有 10.1.1.0/24 网络的路由条目，它通过 OSPF 路由协议从路由器 R2 中动态学习到该条目。</p>
<p>默认路由具有全都是零的网络地址。例如，IPv4 网络地址为 0.0.0.0。路由表中的静态路由条目以 S\ * 的代码开头，如示例中突出显示的那样。</p>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>网络层特征</li>
</ul>
<blockquote>
<p>网络层（OSI 第 3 层），提供能够让终端设备跨整个网络交换数据的服务。IPv4 和 IPv6 是主要的网络层通信协议。网络层还包括路由协议 OSPF 和消息传递协议（如 ICMP）。网络层协议执行四个基本操作：寻址终端设备、封装、路由和解封。IPv4和IPv6指定从一台主机向另一台主机传送数据时使用的数据包结构和处理过程。IP 通过添加 IP 报头来封装传输层数据段，以便传输到目的主机。第3层设备（即路由器）在通过网络传输到其目的地时，会检查IP报头。IP 的特点是它是无连接的、尽最大努力的，并且独立于介质。IP 是无连接协议，这意味着发送数据前IP不会创建专用的端到端连接。IP 协议不保证交付的所有数据包都能被收到。这就是“不可靠”或“尽最大努力”的定义。IP 的运作与在协议栈低层传送数据的介质无关。</p>
</blockquote>
<ul>
<li>IPv4数据包</li>
</ul>
<blockquote>
<p>IPv4 数据包报头是由包含数据包信息的字段组成。这些字段中包含的二进制数字由第 3 层进程进行检查。每个字段的二进制值均用于确定 IP 数据包的各种设置。IPv6报头中的重要字段包括:版本、DS、报头校验和、TTL、协议以及源和目的IPv4地址。</p>
</blockquote>
<ul>
<li>IPv6数据包</li>
</ul>
<blockquote>
<p>IPv6 旨在克服 IPv4 的局限性，包括：IPv4 地址耗尽、缺乏端到端连接以及网络复杂性增加。IPv6 增加了可用的地址空间，改进了数据包处理，并且消除了对 NAT 的需求。IPv6数据包报头中的字段包括：版本、流量类别、流标签、负载长度、下一个报头、跳数限制，以及源IPv6地址和目的IPv6地址。</p>
</blockquote>
<ul>
<li>主机如何路由</li>
</ul>
<blockquote>
<p>主机可以向自己、另一个本地主机和远程主机发送数据包。在 IPv4 中，源设备使用自己的子网掩码以及自己的 IPv4 地址和目的 IPv4 地址确定目的主机是否位于同一网络上。在 IPv6 中，本地路由器将本地网络地址（前缀）通告给网络上的所有设备，以做出此决定。默认网关是可以将流量路由到其他网络的网络设备（即路由器）。在网络上，默认网关通常是一个路由器，它的本地IP地址与本地网络上的其他主机位于相同的地址范围内，可以将数据接收到本地网络并将数据转发到本地网络之外，并将流量路由到其他网络。主机的路由表通常包括默认网关。在IPv4中，主机通过DHCP动态接收默认网关 IPv4 地址，或者通过手动配置。在 IPv6 中，路由器通告默认网关地址，或者可以手动配置主机。在 Windows 主机上，使用route print或命netstat -r令可以显示主机路由表。</p>
</blockquote>
<ul>
<li>路由简介</li>
</ul>
<blockquote>
<p>当一台主机发送数据包到另一台主机时，它将查询路由表来确定将数据包发送到哪里。如果目的主机位于远程网络，则数据包会转发到默认网关。当数据包到达路由器接口时会发生什么? 路由器检查数据包的目的 IP 地址并搜索其路由表以确定将数据包转发到何处。路由表包含所有已知网络地址（前缀）以及数据包转发位置的列表。这些条目称为路由条目或路由。路由器将使用最佳（最长）匹配的路由条目转发数据包。路由器的路由表存储三种类型的路由条目：直连的网络、远程网络和默认路由。路由器通常以动态方式使用路由协议或以手动方式使用静态路由来学习远程网络。静态路由是手动配置的路由条目。静态路由包括远程网络地址和下一跳路由器的IP地址。OSPF 和 EIGRP 是两种动态路由协议。特权 EXEC 模式命令 show ip route 用于查看思科 IOS 路由器上的 IPv4 路由表。IPv4路由表的开头都有一个代码，用于标识路由的类型或路由的学习方式。</p>
</blockquote>
<p>常见路由源（代码）包括：</p>
<ol>
<li><strong>L</strong> - 直连的本地接口 IP 地址</li>
<li><strong>C</strong> - 直连网络</li>
<li><strong>S</strong> - 静态路由由管理员手动配置</li>
<li><strong>O</strong> - 开放最短路径优先 (OSPF)</li>
<li><strong>D</strong> - 增强型内部网关路由协议 (EIGRP)</li>
</ol>
<hr>
<h2 id="Donate-☕️"><a href="#Donate-☕️" class="headerlink" title="Donate ☕️"></a>Donate ☕️</h2><p>如果你喜欢我的博文，可以通过下面的方式支持我，你的支持是我最大的动力 😘</p>
<p>转载时请注明出处 ©️PhoenixNest</p>
<table>
<thead>
<tr>
<th align="center">Donate 😇</th>
<th align="center">Qr code</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Wechat</td>
<td align="center"><img src="/img/wechat.png" alt="Wechat"></td>
</tr>
<tr>
<td align="center">Ali Pay</td>
<td align="center"><img src="/img/alipay.png" alt="Ali Pay"></td>
</tr>
</tbody></table>

            <!--[if lt IE 9]>
            <script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                   data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='https://cdn.jsdelivr.net/gh/PhoenixNest/ImageBed@master/Music/StarCraft Terran Band - Blood and Glory.mp3'></li>
                        
                    
                </ul>
            
            
            
            
                <div id="vcomments"></div>
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="/img/favicon.png" height=300 width=300></img>
                    <p>PhoenixNest</p>
                    <span>用实力让情怀落地</span>
                    
                </div>
                <ul>
                    <li><a href="/">26 <p>文章</p></a></li>
                    <li><a href="/categories">14 <p>分类</p></a></li>
                    <li><a href="/tags">21 <p>标签</p></a></li>
                </ul>
            </div>
            
                
                
                    <div class="box sticky animated fadeInRight faster">
                        <div id="toc" class="subbox">
                            <h4>目录</h4>
                            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%88%E7%AC%AC3%E5%B1%82%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">网络层（第3层）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.1.</span> <span class="toc-text">网络层协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-%E5%B0%81%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">IP 封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-%E7%89%B9%E5%BE%81"><span class="toc-number">2.3.</span> <span class="toc-text">IP 特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.4.</span> <span class="toc-text">无连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%9C%E5%B0%BD%E5%8A%9B%E8%80%8C%E4%B8%BA%E2%80%9D-Best-Effort"><span class="toc-number">2.5.</span> <span class="toc-text">“尽力而为”(Best Effort)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E8%B4%A8%E6%97%A0%E5%85%B3%E6%80%A7"><span class="toc-number">2.6.</span> <span class="toc-text">介质无关性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IPv4-%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="toc-number">3.</span> <span class="toc-text">IPv4 数据包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv4-%E6%95%B0%E6%8D%AE%E5%8C%85%E6%8A%A5%E5%A4%B4"><span class="toc-number">3.1.</span> <span class="toc-text">IPv4 数据包报头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv4-%E6%95%B0%E6%8D%AE%E5%8C%85%E6%8A%A5%E5%A4%B4%E5%AD%97%E6%AE%B5"><span class="toc-number">3.2.</span> <span class="toc-text">IPv4 数据包报头字段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IPv6-%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="toc-number">4.</span> <span class="toc-text">IPv6 数据包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv4-%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-number">4.1.</span> <span class="toc-text">IPv4 的局限性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6-%E6%A6%82%E8%BF%B0"><span class="toc-number">4.2.</span> <span class="toc-text">IPv6 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6%E6%95%B0%E6%8D%AE%E5%8C%85%E6%8A%A5%E5%A4%B4%E4%B8%AD%E7%9A%84IPv4%E6%95%B0%E6%8D%AE%E5%8C%85%E6%8A%A5%E5%A4%B4%E5%AD%97%E6%AE%B5"><span class="toc-number">4.3.</span> <span class="toc-text">IPv6数据包报头中的IPv4数据包报头字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6-%E6%95%B0%E6%8D%AE%E5%8C%85%E6%8A%A5%E5%A4%B4"><span class="toc-number">4.4.</span> <span class="toc-text">IPv6 数据包报头</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E8%B7%AF%E7%94%B1%E6%96%B9%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">主机路由方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E8%BD%AC%E5%8F%91%E5%86%B3%E7%AD%96"><span class="toc-number">5.1.</span> <span class="toc-text">主机转发决策</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E7%BD%91%E5%85%B3"><span class="toc-number">5.2.</span> <span class="toc-text">默认网关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E8%B7%AF%E7%94%B1%E5%88%B0%E9%BB%98%E8%AE%A4%E7%BD%91%E5%85%B3"><span class="toc-number">5.3.</span> <span class="toc-text">主机路由到默认网关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-number">5.4.</span> <span class="toc-text">主机路由表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%AE%80%E4%BB%8B"><span class="toc-number">6.</span> <span class="toc-text">路由简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8C%85%E8%BD%AC%E5%8F%91%E5%86%B3%E7%AD%96"><span class="toc-number">6.1.</span> <span class="toc-text">路由器数据包转发决策</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-%E8%B7%AF%E7%94%B1%E5%99%A8%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-number">6.2.</span> <span class="toc-text">IP 路由器路由表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-number">6.3.</span> <span class="toc-text">静态路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-number">6.4.</span> <span class="toc-text">动态路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv4-%E8%B7%AF%E7%94%B1%E8%A1%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">6.5.</span> <span class="toc-text">IPv4 路由表简介</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">7.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Donate-%E2%98%95%EF%B8%8F"><span class="toc-number">8.</span> <span class="toc-text">Donate ☕️</span></a></li></ol>
                        </div>
                    </div>
                
            
        </div>
    </div>
</div>

    </div>
</div>
<div id="back-to-top" class="animated fadeIn faster">
    <div class="flow"></div>
    <span class="percentage animated fadeIn faster">0%</span>
    <span class="iconfont icon-top02 animated fadeIn faster"></span>
</div>
</body>
<footer>
    <p class="copyright" id="copyright">
        &copy; 2021
        <span class="gradient-text">
            PhoenixNest
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
    </p>
</footer>

    <script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <script>
        MathJax.Hub.Config({
            "HTML-CSS": {
                preferredFont: "TeX",
                availableFonts: ["STIX", "TeX"],
                linebreaks: {
                    automatic: true
                },
                EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
            },
            tex2jax: {
                inlineMath: [
                    ["$", "$"],
                    ["\\(", "\\)"]
                ],
                processEscapes: true,
                ignoreClass: "tex2jax_ignore|dno",
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            },
            TeX: {
                noUndefined: {
                    attributes: {
                        mathcolor: "red",
                        mathbackground: "#FFEEEE",
                        mathsize: "90%"
                    }
                },
                Macros: {
                    href: "{}"
                }
            },
            messageStyle: "none"
        });
    </script>
    <script>
        function initialMathJax() {
            MathJax.Hub.Queue(function () {
                var all = MathJax.Hub.getAllJax(),
                    i;
                // console.log(all);
                for (i = 0; i < all.length; i += 1) {
                    console.log(all[i].SourceElement().parentNode)
                    all[i].SourceElement().parentNode.className += ' has-jax';
                }
            });
        }

        function reprocessMathJax() {
            if (typeof MathJax !== 'undefined') {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            }
        }
    </script>




<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>


<script src="//cdn.bootcss.com/typed.js/2.0.10/typed.min.js"></script>


<script src="//cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script>


<script src="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>


<script src="https://cdn.bootcss.com/codemirror/5.48.4/codemirror.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/css/css.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/xml/xml.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/clike/clike.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/php/php.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/shell/shell.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/python/python.min.js"></script>

  
<script src="/js/busuanzi.min.js"></script>

<script>
    $(document).ready(function () {
        if ($('span[id^="busuanzi_"]').length) {
            initialBusuanzi();
        }
    });
</script>
 
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css">


<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
  

<script>
    function initialTyped() {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ['Let the feelings with the strength landing.', '用实力让情怀落地'],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>

 
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
    var valine = new Valine();

    function initValine(path) {
        if (!path) path = window.location.pathname;
        let language = 'zh-CN';
        if (!language) {
            language = 'en';
        } else {
            language = language.toLowerCase();
        }
        valine.init({
            el: '#vcomments',
            appId: 'HDzkYOSz3NGcQuXbWMLin1mS-gzGzoHsz',
            appKey: 'pJ9JxbsY5D5aEmhxtCSNBlCT',
            notify: '',
            verify: '',
            avatar: '',
            placeholder: '温酒会知音.',
            visitor: 'true',
            path: path,
            lang: language,
        });
    }

    $(document).ready(function () {
        initValine();
    });
</script>



 <!-- 例：百度统计 --> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?your_code"; var s = document.getElementsByTagName("script")[0];  s.parentNode.insertBefore(hm, s); })(); </script> 

</html>
