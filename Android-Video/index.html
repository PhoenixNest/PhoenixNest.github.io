
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Android • Video - PhoenixNest&#39;s Blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate"/>
    
        <meta name="keywords" content="PhoenixNest,PhoenixNest&#39;s Blog,">
    
    
        <meta name="description" content="PhoenixNest&#39;s Blog • 用实力让情怀落地,引言
本篇将介绍我最近在对 Android 项目进行视频编辑功能开发的一些笔记分享。


在阅读本文前，你需要了解常用的 Android 视频播放方式：

（1）：使用 系统自带的播放器 进行播放，,">
    
    
        <meta name="author" content="PhoenixNest">
    
    
        <link rel="alternative" href="atom.xml" title="PhoenixNest&#39;s Blog" type="application/atom+xml">
    
    
        <link rel="icon" href="/img/favicon.png">
    
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.7.2/animate.min.css">

    
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/codemirror.min.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/theme/dracula.css">

    
<link rel="stylesheet" href="/css/obsidian.css">

    
<link rel="stylesheet" href="/css/ball-atom.min.css">

    
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="loading">
<div class="loader">
    <div class="la-ball-atom la-2x">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
</div>
<span id="config-title" style="display:none">PhoenixNest&#39;s Blog</span>
<div id="loader"></div>
<div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/favicon.png" alt="" data-url="https://phoenixnest.github.io">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">Android • Video</h3>
        <div class="social">
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
                animation-delay: 600ms;
                animation-duration: 1.2s;
                background-image:
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(https://cdn.jsdelivr.net/gh/PhoenixNest/Blog-Repository@master/Notes/Android/Android.png) ">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                    <a href="/categories/Android"><b>「
                        </b>ANDROID<b> 」</b></a>
                
                六月 24, 2022
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/Android-Video/" title="Android • Video" class="">Android • Video</a>
            </h3>
            
                <p class="post-count animated fadeInDown">
                    
                        <span>
                    <b class="iconfont icon-text2"></b> <i>文章字数</i>
                    9.4k
                </span>
                    
                    
                        <span>
                    <b class="iconfont icon-timer__s"></b> <i>阅读约需</i>
                    17 mins.
                </span>
                    
                    
                        <span id="/Android-Video/" class="leancloud_visitors"
                              data-flag-title="Android • Video">
                    <b class="iconfont icon-read"></b> <i>阅读次数</i>
                    <span class="leancloud-visitors-count">0</span>
                </span>
                    
                    
                </p>
            
            
                <ul class="animated fadeInDown post-tags-list" itemprop="keywords"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/Video/" rel="tag">Video</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s">Beyond The World</span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><blockquote>
<p>本篇将介绍我最近在对 <code>Android</code> 项目进行<code>视频编辑</code>功能开发的一些笔记分享。</p>
</blockquote>
<blockquote>
<p>在阅读本文前，你需要了解常用的 Android 视频播放方式：</p>
<ul>
<li>（1）：使用 <code>系统自带的播放器</code> 进行播放，该方式需要指定 Intent的Action为ACTION_VIEW，Data为视频Uri，Type为待播放视频的MIME类型；</li>
<li>（2）：使用 <code>VideoView</code> 播放视频；</li>
<li>（3）：使用 <code>SurfaceView + MediaPlayer</code> 播放视频（<code>推荐做法</code>）。</li>
</ul>
</blockquote>
<hr>
<h2 id="SurfaceView"><a href="#SurfaceView" class="headerlink" title="SurfaceView"></a>SurfaceView</h2><blockquote>
<p>Google 官方文档中对于 <a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/view/SurfaceView">SurfaceView</a> 的介绍：</p>
</blockquote>
<p>Provides a dedicated drawing surface embedded inside of a view hierarchy. You can control the format of this surface and, if you like, its size; the SurfaceView takes care of placing the surface at the correct location on the screen.</p>
<hr>
<h2 id="MediaPlayer"><a href="#MediaPlayer" class="headerlink" title="MediaPlayer"></a>MediaPlayer</h2><blockquote>
<p>Google 官方文档中对于 <a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/media/mediaplayer">MediaPlayer</a> 的介绍：</p>
</blockquote>
<p>The Android multimedia framework includes support for playing variety of common media types, so that you can easily integrate audio, video and images into your applications. You can play audio or video from media files stored in your application’s resources (raw resources), from standalone files in the filesystem, or from a data stream arriving over a network connection, all using MediaPlayer APIs.</p>
<blockquote>
<p>MediaPlayer 是 Android 多媒体组件库中至关重要的一员，通常用于对视频进行装载，播放，控制等操作。</p>
</blockquote>
<pre><code class="kotlin">val mediaPlayer = MediaPlayer()

// 通过 Surface + MediaPlayer 进行视频播放
try &#123;
  // 从videoPath中加载视频资源，该路径可以是视频路径，也可以是网络地址
  mediaPlayer.setDataSource(videoPath)

  // 配合 Surface 进行视频渲染
  val surface = Surface(surfaceTexture)
  mediaPlayer.setSurface(surface)
  surface.release() // 加载完毕后及时释放 Surface 资源

  // 控制视频循环播放
  mediaPlayer.isLooping = true

  // 视频资源装载完成时，回调该监听器，该监听器类型为：MediaPlayer.OnPreparedListener
  // 在该监听器中，可进行一些常用组件的自定义设置，比如通过获取视频宽高，动态调整相应布局
  mediaPlayer.setOnPreparedListener(listener: MediaPlayer.OnPreparedListener)

  // 视频播放预处理
  mediaPlayer.prepare()

  // 播放视频，该方法也可用来恢复当前播放进度
  mediaPlayer.start()
&#125; catch(exception: Exception) &#123;
  println(&quot;mediaPlayer Error&quot;)
&#125;

// 其他常用 MediaPlayer 控制视频播放方法：
// 暂停播放
mediaPlayer.pause()

// 重置 MediaPlayer资源，调用该方法后需重新对 MediaPlayer 进行初始化
mediaPlayer.reset()

// 释放视频资源
mediaPlayer.release()

// 跳转到指定进度
mediaPlayer.seekTo(msec: Int)
// mediaPlayer.seekTo(msec: Int, mode: Int)
</code></pre>
<pre><code class="kotlin">// MediaPlayer 视频信息相关方法：
// 获取视频总长度
mediaPlayer.duration

// 获取视频当前进度 
mediaPlayer.currentPosition

// 获取视频宽度
mediaPlayer.videoWidth

// 获取视频高度
mediaPlayer.videoHeight

// 获取视频轨道信息
mediaPlayer.trackInfo

// 调整视频音量
mediaPlayer.setVolume(leftVolume: Float, rightVolume: Float) // 左，右声道音量
</code></pre>
<hr>
<h2 id="MediaMetadataRetriever"><a href="#MediaMetadataRetriever" class="headerlink" title="MediaMetadataRetriever"></a>MediaMetadataRetriever</h2><blockquote>
<p>Google 官方文档中对于 <a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/media/MediaMetadataRetriever">MediaMetadataRetriever</a> 的介绍：</p>
</blockquote>
<p>MediaMetadataRetriever class provides a unified interface for retrieving frame and meta data from an input media file.</p>
<blockquote>
<p>MediaMetaDataRetriever 常用于提取视频原始信息，如视频第一帧图片，视频源数据长度，视频源数据作者等静态信息。</p>
</blockquote>
<pre><code class="kotlin">val mediaMetaRetriever = MediaMetadataRetriever()

// 设置视频资源
mediaMetadataRetriever.setDataSource(path: String!)

mediaMetadataRetriever.setDataSource(path: String!, headers: (Mutable)Map&lt;String!, String!&gt;!)

mediaMetadataRetriever.setDataSource(fileDescriptor: FileDescriptor!)

mediaMetadataRetriever.setDataSource(fileDescriptor: FileDescriptor!, offset: Long, length: Long)

mediaMetadataRetriever.setDataSource(context: Context!, uri: Uri!)

mediaMetadataRetriever.setDataSource(dataSource: MediaDataSource!)
</code></pre>
<pre><code class="kotlin">// 常用的一些视频元数据信息
MediaMetadataRetriever.METADATA_KEY_DURATION // 视频长度
MediaMetadataRetriever.METADATA_KEY_DATE // 视频创建日期
MediaMetadataRetriever.METADATA_KEY_VIDEO_HEIGHT // 视频高度
MediaMetadataRetriever.METADATA_KEY_VIDEO_WIDTH // 视频高度
...

// 使用 extractMetadata() 方法提取视频元数据信息，建议在子线程中调用该方法
// 如：获取视频长度信息
mediaMetadataRetriever.extractMetadata(MediaMetadataRetriever.METADATA_KEY_DURATION)
</code></pre>
<hr>
<h2 id="MediaController"><a href="#MediaController" class="headerlink" title="MediaController"></a>MediaController</h2><blockquote>
<p>Google 官方文档中对于 <a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/widget/MediaController">MediaController</a> 的介绍：</p>
</blockquote>
<p>A view containing controls for a MediaPlayer. Typically contains the buttons like “Play/Pause”, “Rewind”, “Fast Forward” and a progress slider. It takes care of synchronizing the controls with the state of the MediaPlayer.</p>
<blockquote>
<p>MediaController 提供了一个悬浮的控制栏，默认情况下，该控制栏会显示3秒，然后自动隐藏，该控制栏通常配合 VideoView 使用。</p>
</blockquote>
<pre><code class="kotlin">// MediaController 控制器相关方法：
// 添加 MediaController 至 VideoView，对视频播放进行控制。
val mediaController = MediaController(requireContext())

// 显示控制器
mediaController.show()

mediaController.show(timeout: Int) // 在 timeout 个微秒时间后，自动隐藏控制器

// 隐藏控制器
mediaController.hide()

// 控制器显示状态，返回值类型：Boolean
mediaController.isShowing()

// 控制是否显示 &lt;上一个/下一个视频&gt; 按钮
mediaController.setPrevNextListeners(next: View.OnClickListener!, prev: View.OnClickListener!)
</code></pre>
<hr>
<h3 id="与-MediaPlayerControl-配合使用"><a href="#与-MediaPlayerControl-配合使用" class="headerlink" title="与 MediaPlayerControl 配合使用"></a>与 MediaPlayerControl 配合使用</h3><pre><code class="kotlin">mediaController.setMediaPlayer(player: MediaController.MediaPlayControl!)
</code></pre>
<hr>
<h3 id="与-VideoView-配合使用"><a href="#与-VideoView-配合使用" class="headerlink" title="与 VideoView 配合使用"></a>与 VideoView 配合使用</h3><pre><code class="kotlin">// 绑定 mediaController 到 videoView
mediaController.setAnchorView(view: View!) // Example: mediaController.setAnchorView(mVideoView)
videoView.setMediaController(mediaController)
</code></pre>
<hr>
<h2 id="VideoView"><a href="#VideoView" class="headerlink" title="VideoView"></a>VideoView</h2><blockquote>
<p>Google 官方文档中对于 <a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/widget/VideoView">VideoView</a> 的介绍：</p>
</blockquote>
<p>Displays a video file. The VideoView class can load images from various sources (such as resources or content providers), takes care of computing its measurement from the video so that it can be used in any layout manager, and provides various display options such as scaling and tinting.</p>
<blockquote>
<p>VideoView = SurfaceView + MediaPlayer + MediaController，VideoView 是对 SurfaceView，MediaPlayer与MediaController 的视频化封装，对上层提供开箱即用的接口方法支持。</p>
</blockquote>
<pre><code class="kotlin">// VideoView有多种方法可进行视频播放：
// 方法1：通过视频Uri进行视频播放
videoView.setVideoURI(uri: Uri!)

videoView.setVideoURI(uri: Uri!, headers: (Mutable)Map&lt;String!, String!&gt;)

// 方法2：通过视频文件路径进行视频播放，该方法也可用于播放在线视频
// 若播放在线视频，需先在 Manifests清单文件 中申请网络请求权限:&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
videoView.setVideoPath(path: String!)

// 开始播放
videoView.start()

// 请求当前屏幕焦点至VideoView，可配合 videoView.start() 使用
videoView.requestFocus() 

// 恢复播放
videoView.resume()

// 暂停播放
videoView.pause()

// 检查当前播放视频是否可被暂停，可用于 App 从后台切换至前台
videoView.canPause()

// 该方法会调用 mediaPlayer.release() 方法，会释放当前绑定的视频资源
videoView.stopPlayback()

// 视频跳至目标点播放
videoView.seekTo(msec: Int)

// 检查当前视频可跳至目标点播放
// Forward：向前播放
// Backward：向后播放
videoView.canSeekForward()
videoView.canSeekBackward()
</code></pre>
<pre><code class="kotlin">// VideoView 视频相关信息方法：
// 获取视频总长度，返回值类型：Int
videoView.duration

// 获取当前播放进度，返回值类型：Int
videoView.currentPosition

// 检查当前视频是否正在播放，返回值类型：Boolean
videoView.isPlaying

// 视频资源装载完成时，回调该监听器，该监听器类型为：MediaPlayer.OnPreparedListener
videoView.setOnPreparedListener(listener: MediaPlayer.OnPreparedListener!)

// 视频播放出错时，回调该监听器，该监听器类型为：MediaPlayer.OnErrorListener
videoView.setOnErrorListener(listener: MediaPlayer.OnErrorListener!)

// 视频播放完成时，回调该监听器，该监听器类型为：MediaPlayer.OnCompletionListener
videoView.setOnCompletionListener(listener: MediaPlayer.OnCompletionListener!)
</code></pre>
<h3 id="与-MediaPlayer-配合使用"><a href="#与-MediaPlayer-配合使用" class="headerlink" title="与 MediaPlayer 配合使用"></a>与 MediaPlayer 配合使用</h3><blockquote>
<p>循环播放</p>
</blockquote>
<pre><code class="kotlin">// 推荐写法：
videoVideo.setOnPreparedListener &#123; mediaPlayer -&gt; 
    mediaPlayer.isLooping = true
&#125;

// 也可在 setOnCompletionListener 中对 mediaPlayer 进行设置（本质上只是对 VideoView 中封装的 MediaPlayer 进行再播放设置）
videoView.setOnCompletionListener &#123; mediaPlayer -&gt;
    mediaPlayer.start()
&#125;
</code></pre>
<hr>
<h2 id="Open-Source-Framework"><a href="#Open-Source-Framework" class="headerlink" title="Open Source Framework"></a>Open Source Framework</h2><h3 id="Mp4Parser"><a href="#Mp4Parser" class="headerlink" title="Mp4Parser"></a>Mp4Parser</h3><blockquote>
<p>作者仓库 README 中对于 <a target="_blank" rel="noopener" href="https://github.com/sannies/mp4parser">Mp4Parser</a> 的介绍：</p>
</blockquote>
<p>A Java API to read, write and create MP4 container. Manipulating containers is different from encoding and decoding videos and audio.</p>
<blockquote>
<p>MP4音视频处理：</p>
<ul>
<li>将音视频文件合并到一个MP4文件；</li>
<li>将编码格式相同的录音进行拼接合并；</li>
<li>添加或修改音视频元数据；</li>
<li>通过省略帧缩短音视频；</li>
</ul>
</blockquote>
<hr>
<h3 id="Mp4Composer-Android"><a href="#Mp4Composer-Android" class="headerlink" title="Mp4Composer-Android"></a>Mp4Composer-Android</h3><p><a target="_blank" rel="noopener" href="https://github.com/MasayukiSuda/Mp4Composer-android">Github • Mp4Composer-Android</a></p>
<blockquote>
<p>作者仓库 README 中对于 <a target="_blank" rel="noopener" href="https://github.com/MasayukiSuda/Mp4Composer-android">Mp4Composer-Android</a> 的介绍：</p>
</blockquote>
<p>This library generate an Mp4 movie using Android MediaCodec API and apply filter, scale, trim, transcode, crop, mute and rotate Mp4.</p>
<blockquote>
<p>Android 视频处理，添加滤镜，裁剪，旋转，改变大小。</p>
</blockquote>
<hr>
<h3 id="SiliCompressor"><a href="#SiliCompressor" class="headerlink" title="SiliCompressor"></a>SiliCompressor</h3><p><a target="_blank" rel="noopener" href="https://github.com/Tourenathan-G5organisation/SiliCompressor">Github • SiliCompressor</a></p>
<blockquote>
<p>作者仓库 README 中对于 <a target="_blank" rel="noopener" href="https://github.com/Tourenathan-G5organisation/SiliCompressor">SiliCompressor</a> 的介绍：</p>
</blockquote>
<p>A powerful, flexible and easy to use Video and Image compression library for Android.</p>
<p>Image: It’s usually said that “A picture is worth a thousand words”. Images adds flair and beauty to our android apps, but we usaully have problems with these images due to thier large size. With SiliCompressor you can now compress and use your images more smoothly.</p>
<p>Video: Due to the high resolution of our Smartphone cameras and cameras from other devices, Video files have become large in size and thus difficult for it to be shared with others on social apps, social media and even when we need to upload it on our server. With SiliCompressor you can now compress you video file while maintaining it quality.</p>
<blockquote>
<p>图像与视频压缩。</p>
</blockquote>
<hr>
<h2 id="Wechat-Video-Editor"><a href="#Wechat-Video-Editor" class="headerlink" title="Wechat Video Editor"></a>Wechat Video Editor</h2><blockquote>
<p>本章节将介绍如何仿制 Wechat （微信）的视频编辑页，使用到的技术如下：</p>
</blockquote>
<ul>
<li><p>SurfaceView + MediaPlayer</p>
</li>
<li><p>Custom RangeSeekbar ( Thumbnail RecyclerView + Video Indicator )</p>
</li>
<li><p>Video Clipping &amp; Compress</p>
</li>
</ul>
<hr>
<h3 id="SurfaceView-MediaPlyer"><a href="#SurfaceView-MediaPlyer" class="headerlink" title="SurfaceView + MediaPlyer"></a>SurfaceView + MediaPlyer</h3><blockquote>
<ol>
<li><p>初始化 SurfaceView</p>
</li>
<li><p>初始化 MediaPlayer</p>
</li>
</ol>
</blockquote>
<pre><code class="kotlin">val mediaPlayer = MediaPlayer()

// 通过 Surface + MediaPlayer 进行视频播放
try &#123;
  // 从videoPath中加载视频资源，该路径可以是视频路径，也可以是网络地址
  mediaPlayer.setDataSource(videoPath)

  // 配合 SurfaceView 进行视频渲染
  val surface = Surface(surfaceTexture)
  mediaPlayer.setSurface(surface)
  surface.release() // 加载完毕后及时释放 Surface 资源

  // 控制视频循环播放
  mediaPlayer.isLooping = true

  // 视频资源装载完成时，回调该监听器，该监听器类型为：MediaPlayer.OnPreparedListener
  // 在该监听器中，可进行一些常用组件的自定义设置，比如通过获取视频宽高，动态调整相应布局
  mediaPlayer.setOnPreparedListener&#123; player -&gt;
    // 可对 Ui 布局进行适配，如：根据视频宽高动态设置 Ui 布局宽高
  &#125;

  // 视频播放预处理
  mediaPlayer.prepare()

  // 播放视频，该方法也可用来恢复当前播放进度
  mediaPlayer.start()
&#125; catch(exception: Exception) &#123;
  println(&quot;mediaPlayer Error&quot;)
&#125;
</code></pre>
<hr>
<h3 id="Thumbnail-RecyclerView"><a href="#Thumbnail-RecyclerView" class="headerlink" title="Thumbnail RecyclerView"></a>Thumbnail RecyclerView</h3><blockquote>
<ol>
<li><p>准备 RecyclerView Item Layout（此处省略）</p>
</li>
<li><p>准备 RecyclerView Adapter（此处省略）</p>
</li>
<li><p>绑定 RecyclerView OnScrollListener</p>
</li>
</ol>
</blockquote>
<pre><code class="kotlin">private val rvScrollListener: RecyclerView.OnScrollListener = object: RecyclerView.OnScrollListener()&#123;
    override fun onScrollStateChanged(recyclerView: RecyclerView, newState: Int)&#123;
        super.onScrollStateCHanged(recyclerView, newState)
        if (newState == RecyclerView.SCROLL_STATE_IDLE) &#123;
            // RecyclerView 停止滑动，进行相应事件处理
        &#125; else &#123;
            // RecyclerView 开始滑动，进行相应事件处理
        &#125;
    &#125;

    override fun onScrolled(recyclerView: RecyclerView, dx: Int, dy: Int)&#123;
        super.onScrolled(recyclerView, dx, dy)
        // RecyclerView 滑动中，进行相应事件处理
    &#125;
&#125;

// 绑定滑动监听器至 RecyclerView
recyclerView.addOnScrollListener(rvScrollListener)
</code></pre>
<hr>
<h3 id="Video-Indictor"><a href="#Video-Indictor" class="headerlink" title="Video Indictor"></a>Video Indictor</h3><blockquote>
<ol>
<li><p>准备 Indictor 外框</p>
</li>
<li><p>设置 Indictor 动画</p>
</li>
</ol>
</blockquote>
<hr>
<h3 id="Custom-RangeSeekbar"><a href="#Custom-RangeSeekbar" class="headerlink" title="Custom RangeSeekbar"></a>Custom RangeSeekbar</h3><blockquote>
<ol>
<li><p>从视频元数据抽取逐帧预览图</p>
</li>
<li><p>加载预览图至 Thumbnail RecyclerView</p>
</li>
<li><p>设置 RangeSeekbar 滑动监听</p>
</li>
</ol>
</blockquote>
<hr>
<h3 id="Video-Clipping"><a href="#Video-Clipping" class="headerlink" title="Video Clipping"></a>Video Clipping</h3><blockquote>
<p>此方案使用来自GIthub的开源视频编辑库：<a target="_blank" rel="noopener" href="https://github.com/MasayukiSuda/Mp4Composer-android">Mp4Composer-android</a></p>
</blockquote>
<blockquote>
<ol>
<li><p>设置原始视频路径，裁剪视频输出路径，视频裁剪模式等参数</p>
</li>
<li><p>在<code>子线程</code>中进行视频裁剪</p>
</li>
<li><p>将裁剪完成的视频路径作为待压缩视频的原始路径</p>
</li>
</ol>
</blockquote>
<hr>
<h3 id="Video-Compress"><a href="#Video-Compress" class="headerlink" title="Video Compress"></a>Video Compress</h3><blockquote>
<p>此方案使用来自Github的开源视频压缩库：<a target="_blank" rel="noopener" href="https://github.com/Tourenathan-G5organisation/SiliCompressor">SiliCompressor</a></p>
</blockquote>
<blockquote>
<ol>
<li><p>设置原始视频路径，压缩视频输出路径</p>
</li>
<li><p>在<code>子线程</code>中进行视频压缩</p>
</li>
<li><p>输出最终的视频路径</p>
</li>
</ol>
</blockquote>
<pre><code class="kotlin">// SiliCompressor 可在压缩前设置输出参数，包括输出视频宽高与比特率

SiliCompressor.with(context).compressVideo(srcUri, destPath)

SiliCompressor.with(context).compressVideo(srcPath, destPath)

SiliCompressor.with(context).compressVideo(srcPath, destPath, outputVideoWidth, outputVideoHeight, outputBitrate)

SiliCompressor.with(context).compressVideo(srcUri, destPath, outputVideoWidth, outputVideoHeight, outputBitrate)
</code></pre>
<hr>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><p>高仿微信视频编辑 + 视频滤镜：<a target="_blank" rel="noopener" href="https://github.com/LLhon/Android-Video-Editor">Github • Android Video Editor</a></p>
</li>
<li><p>高仿微信视频编辑：<a target="_blank" rel="noopener" href="https://github.com/ta893115871/VideoEdit">Github • VideoEdit</a></p>
</li>
</ul>

            <!--[if lt IE 9]>
            <script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                   data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='https://cdn.jsdelivr.net/gh/PhoenixNest/Blog-Repository@master/Music/StarCraft%20Terran%20Band%20-%20Blood%20and%20Glory.mp3'></li>
                        
                    
                </ul>
            
            
            
            
                <hr>
                <div id="vcomments"></div>
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="/img/portrait.png" height=300 width=300 />
                    <p>PhoenixNest</p>
                    <span>用实力让情怀落地</span>
                    
                </div>
                <ul>
                    <li><a href="/">43 <p>文章</p></a></li>
                    <li><a href="/categories">18 <p>分类</p></a></li>
                    <li><a href="/tags">35 <p>标签</p></a></li>
                </ul>
            </div>
            
                
                
                    <div class="box sticky animated fadeInRight faster">
                        <div id="toc" class="subbox">
                            <h4>目录</h4>
                            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SurfaceView"><span class="toc-number">2.</span> <span class="toc-text">SurfaceView</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MediaPlayer"><span class="toc-number">3.</span> <span class="toc-text">MediaPlayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MediaMetadataRetriever"><span class="toc-number">4.</span> <span class="toc-text">MediaMetadataRetriever</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MediaController"><span class="toc-number">5.</span> <span class="toc-text">MediaController</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-MediaPlayerControl-%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">5.1.</span> <span class="toc-text">与 MediaPlayerControl 配合使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-VideoView-%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">5.2.</span> <span class="toc-text">与 VideoView 配合使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VideoView"><span class="toc-number">6.</span> <span class="toc-text">VideoView</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-MediaPlayer-%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">6.1.</span> <span class="toc-text">与 MediaPlayer 配合使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Open-Source-Framework"><span class="toc-number">7.</span> <span class="toc-text">Open Source Framework</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mp4Parser"><span class="toc-number">7.1.</span> <span class="toc-text">Mp4Parser</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mp4Composer-Android"><span class="toc-number">7.2.</span> <span class="toc-text">Mp4Composer-Android</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SiliCompressor"><span class="toc-number">7.3.</span> <span class="toc-text">SiliCompressor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wechat-Video-Editor"><span class="toc-number">8.</span> <span class="toc-text">Wechat Video Editor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SurfaceView-MediaPlyer"><span class="toc-number">8.1.</span> <span class="toc-text">SurfaceView + MediaPlyer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thumbnail-RecyclerView"><span class="toc-number">8.2.</span> <span class="toc-text">Thumbnail RecyclerView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Video-Indictor"><span class="toc-number">8.3.</span> <span class="toc-text">Video Indictor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-RangeSeekbar"><span class="toc-number">8.4.</span> <span class="toc-text">Custom RangeSeekbar</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Video-Clipping"><span class="toc-number">8.5.</span> <span class="toc-text">Video Clipping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Video-Compress"><span class="toc-number">8.6.</span> <span class="toc-text">Video Compress</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">9.</span> <span class="toc-text">Reference</span></a></li></ol>
                        </div>
                    </div>
                
            
        </div>
    </div>
</div>

    </div>
</div>
<div id="back-to-top" class="animated fadeIn faster">
    <div class="flow"></div>
    <span class="percentage animated fadeIn faster">0%</span>
    <span class="iconfont icon-top02 animated fadeIn faster"></span>
</div>
</body>
<footer>
    <p class="copyright" id="copyright">
        &copy; 2024
        <span class="gradient-text">
            PhoenixNest
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
    </p>
</footer>

    <script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <script>
        MathJax.Hub.Config({
            "HTML-CSS": {
                preferredFont: "TeX",
                availableFonts: ["STIX", "TeX"],
                linebreaks: {
                    automatic: true
                },
                EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
            },
            tex2jax: {
                inlineMath: [
                    ["$", "$"],
                    ["\\(", "\\)"]
                ],
                processEscapes: true,
                ignoreClass: "tex2jax_ignore|dno",
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            },
            TeX: {
                noUndefined: {
                    attributes: {
                        mathcolor: "red",
                        mathbackground: "#FFEEEE",
                        mathsize: "90%"
                    }
                },
                Macros: {
                    href: "{}"
                }
            },
            messageStyle: "none"
        });
    </script>
    <script>
        function initialMathJax() {
            MathJax.Hub.Queue(function () {
                var all = MathJax.Hub.getAllJax(),
                    i;
                // console.log(all);
                for (i = 0; i < all.length; i += 1) {
                    console.log(all[i].SourceElement().parentNode)
                    all[i].SourceElement().parentNode.className += ' has-jax';
                }
            });
        }

        function reprocessMathJax() {
            if (typeof MathJax !== 'undefined') {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            }
        }
    </script>




<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>


<script src="//cdn.bootcss.com/typed.js/2.0.10/typed.min.js"></script>


<script src="//cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script>


<script src="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>


<script src="https://cdn.bootcss.com/codemirror/5.48.4/codemirror.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/css/css.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/xml/xml.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/clike/clike.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/php/php.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/shell/shell.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/python/python.min.js"></script>

  
<script src="/js/busuanzi.min.js"></script>

<script>
    $(document).ready(function () {
        if ($('span[id^="busuanzi_"]').length) {
            initialBusuanzi();
        }
    });
</script>
 
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css">


<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
  

<script>
    function initialTyped() {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ['Beyond The World', '用实力让情怀落地'],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>

 
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
    var valine = new Valine();

    function initValine(path) {
        if (!path) path = window.location.pathname;
        let language = 'zh-CN';
        if (!language) {
            language = 'en';
        } else {
            language = language.toLowerCase();
        }
        valine.init({
            el: '#vcomments',
            appId: 'HDzkYOSz3NGcQuXbWMLin1mS-gzGzoHsz',
            appKey: 'pJ9JxbsY5D5aEmhxtCSNBlCT',
            notify: '',
            verify: '',
            avatar: '',
            placeholder: '温酒会知音 😉',
            visitor: 'true',
            path: path,
            lang: language,
        });
    }

    $(document).ready(function () {
        initValine();
    });
</script>



 <!-- 例：百度统计 --> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?your_code"; var s = document.getElementsByTagName("script")[0];  s.parentNode.insertBefore(hm, s); })(); </script> 

</html>
